<!DOCTYPE html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style> /* set the CSS */
    body {font-family: "Times New Roman", Georgia, Serif;}
    h1,h2,h3,h4,h5,h6 {
        font-family: "Playfair Display";
        letter-spacing: 5px;
    }
    button {
    border: none;
    background-color: transparent;
    outline: none;
    padding: 0px;
    margin: 0px 0px;
    border: 0px;
    height: 100%
    }
    button:hover {
    border: 1px solid;
    }
    .svg-container {
    display: inline-block;
    position: relative;
    width: 100%;
    padding-bottom: 100%; /* aspect ratio */
    vertical-align: top;
    overflow: hidden;
    }
    .svg-content-responsive {
    display: inline-block;
    position: absolute;
    top: 10px;
    left: 0;
}
</style>
<head>
  <title>Data Visualization Course: Assignment 1</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
      <!-- load the d3.js library -->    
    <script src="https://d3js.org/d3.v3.min.js"></script>
</head>
<body>
    <!-- Navbar (sit on top) -->
<nav class="w3-top">
  <div class="w3-bar w3-white w3-padding w3-card-2" style="letter-spacing:4px;">
    <a href="#home" class="w3-bar-item">Assignment 1</a>
    <!-- Right-sided navbar links. Hide them on small screens -->
    <div class="w3-right w3-hide-small">
      <a class="w3-bar-item">sanec@fotonik.dtu.dk</a>
    </div>
  </div>

</nav>
<!-- Header -->
<header class="w3-container w3-center" style="max-width:1600px;min-width:500px" id="home">
    <!-- <div class="w3-display-bottomleft w3-padding-large" style="color:black"> -->
    <div class="w3-content" style="margin-top:60px" >
        <h1 class="w3-xxlarge"> Visualization of numerical data</h1>
    </div>
    <!-- </div> -->
</header>
<!-- Page content -->
<div class="w3-content" >

    <!-- load data--> 
    <script src="data/declaration.js"></script>
    <div class="w3-row w3-padding" id="figure_container">
        <p>
      <h2> About the data </h2> 

    This data visualization example is based on climate data from the Goddard Institute for Space Studies (GISS). 
    </p>
    <p class = 'w3-justify'>
    In particular, I used a dataset from the <a href="https://data.giss.nasa.gov/gistemp/"> GISS Surface Temperature Analysis (GISTEMP) proyect</a>.
    The GISTEMP proyect aims at finding an estimate of global temperature change that can be compared with expected global climate change in response to known or suspected climate forcing mechanisms such as atmospheric carbon dioxide, volcanic aerosols, and solar irradiance changes.
    </p>
    <p class = 'w3-justify'>
    The next graph shows Combined Land-Surface Air and Sea-Surface Water Temperature Anomalies from 1880 to 2014. The temperature anomalies are represented by means of the Land-Ocean Temperature Index (LOTI), which to my understanding is a measure of both land and oceanic temperatures over a given area. In this case I have used the subsets of Global, Northern and Southern Hemispheres. 
    </p>
    <p class = 'w3-justify'>
Note: LOTI provides a more realistic representation of the global mean trends than meteorological station data (dTs). it slightly underestimates warming or cooling trends, since the much larger heat capacity of water compared to air causes a slower and diminished reaction to changes; dTs on the other hand overestimates trends, since it disregards most of the dampening effects of the oceans that cover about two thirds of the Earth's surface.

    </p>
    </div>
    <div class="w3-row w3-center" id="figure_container" style="width:800px;height:600px; margin-left: 60px">
        <div class="w3-center" id="tester" style="width:800px;height:600px; position:relative">
            <div class="toggle" id="toggle_mean" style="position:absolute; bottom:300px; right:20px">
            <button type="button" class="btn btn-success">
                Toggle 5 year mean
                <!-- <script>
                var svg = d3.select('#toggle_mean')
                            .append('svg')
                            .attr('width', 100)
                            .attr('height', 50)
                    svg.append('rect')
                        .attr('width',100)
                        .attr('height',50)
                        .attr('x',0)
                        .attr('y',0)    
                        .style("opacity", 1)   
                        .style("stroke", "blue")                        
                        .style('fill','none')
                </script> -->
            </button>

            </div>
            <div class="hideshow" id="glob" style="position:absolute; bottom:100px; right:-20px">
                <button id='blue_btn'>
                    <!-- <img src="https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg", id='world_map'> -->
                <a title="Al MacDonald [2]/ twitter account @F1LT3R [CC BY-SA 3.0 (http://creativecommons.org/licenses/by-sa/3.0)], via Wikimedia Commons" ><img width="220" alt="World map - low resolution" src="https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg" id ="world_fig"/>
                </a>
                </button>
            </div>
            <div class="hideshow" id="n_hem" style="position:absolute; bottom:165px; right:-20px">
                <button id='orange_btn'>
                <script>
                    var svg = d3.select('#orange_btn')
                                .append('svg')
                                .attr('width',document.getElementById('world_fig').width/2)
                                .attr('height', document.getElementById('world_fig').height/2 )
                    svg.append('rect')
                        .attr('width',document.getElementById('world_fig').width/2)
                        .attr('height', document.getElementById('world_fig').height/2 )
                        .attr('x',0)
                        .attr('y',0)    
                        .style("opacity", .2)   
                        .style("stroke", "blue")                        
                        .style('fill','blue')
                </script>
                </button>
            </div>
            <div class="hideshow" id="s_hem" style="position:absolute; bottom:93px; right:-20px">
                <button id='green_btn'>
                <script>
                    var svg = d3.select('#green_btn')
                                .append('svg')
                                .attr('width',document.getElementById('world_fig').width/2)
                                .attr('height', document.getElementById('world_fig').height/2 )
                    svg.append('rect')
                        .attr('width',document.getElementById('world_fig').width/2)
                        .attr('height', document.getElementById('world_fig').height/2 )
                        .attr('x',0)
                        .attr('y',0)
                        .style("opacity", .2)   
                        .style("stroke", "green")       
                        .style('fill','green')
                </script>
                </button>
            </div>
        </div>
    </div>
    
    <div class="w3-row w3-padding" id="instructions">
        <p>
          <h2> Basic use instructions </h2>  
        
        <ul>
            <li>Predefined Plotly navigation tools in the upper right corner of the graph</li>
            <li>Click and drag in the canvas to zoom in</li>
            <li>Double click the canvas to zoom out</li>
            <li>Click the elements in the legend to toggle display</li>
            <li>Click on the map sections or double-click the elements in the legend to display only one</li>
            <li> Toggle mean button shows 5 year running mean of data</li>
        </ul>
        </p>
    </div>
<!-- End page content -->
</div>
<!-- Footer -->
<footer class="w3-center w3-light-grey w3-padding-32">
  <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-text-green">w3.css</a></p>
</footer>

<script>

    function unpack(rows, key) {
     return rows.map(function(row) { return row[key]; });
    }        // Plotly.newPlot('tester',data);

    function moving_mean(x,y){
        var N = x.length;
        var someData = [];
        for (var i = 0; i < N; i++)
        {
            someData.push([i,y[i]]);
        }
        var moveMean = [0,0];
        for (var i = 2; i < N-2; i++)
        {
            var mean = ( someData[i-2][1] + 
                         someData[i-1][1] + 
                         someData[i][1]   + 
                         someData[i+1][1]+ 
                         someData[i+2][1])/5.0;
            moveMean.push(mean);
        }    
        return moveMean
    }

    var scopes = ["Glob","NHem","SHem"];
    var names  = ["Global","North Hemisphere","South Hemisphere"];
    var dashes = ['solid','dashdot','dash'];
    var colors = ['red','blue','green'];
    var widths = [3,1,1];
    var x = unpack(data, 'Year');
    var y_array = [];
    var y_array_mean = [];
    var mean_flag = true;

    var new_data = scopes.map(function(scope, i){
        var y = unpack(data, scope);
        for (var y_idx = y.length - 1; y_idx >= 0; y_idx--) {
            y[y_idx] = y[y_idx]/10;
        };
        var mode = 'markers';
        var text = scope;
        var trace = {
            x:x,
            y:y,
            type: 'scatter',
            text: scopes[i],
            name: names[i],
            line: {
                dash: dashes[i],
                width: widths[i],
                color: colors[i]
            },
            hoverinfo:"x+y+text",
            visible: true
        };
        y_array[i] = y;
        y_array_mean[i] = moving_mean(x,y);
        return trace
    });

    
    var layout = {
        xaxis:
        {
            title: "Year",
            showgrid: false,
            domain:[d3.min(x),d3.min(x)],
            showline:true,
            linewidth:2,
            zerolinecolor:"#6e7075",
            spikethickness:1
        },
        yaxis:
        {
            title: "Temperature anomaly (&deg;C)",
            position: 0,
            color: "black",
            showline: true,
            showgrid: true,
            linewidth:2,
            spikethickness:1
        },
        hovermode: 'closest',
        title: 'Land-Ocean Temperature Index',
        showlegend: true,
        font: {size:15},
        zerolinecolor:"#6e7075"

    };
    
    Plotly.newPlot('tester', new_data, layout, {scrollZoom: false});
    
    $('.toggle button').click(function(){
        var btn_id = this.parentNode.id;
        data = document.getElementById("tester").data
        if (mean_flag === true){
            for (var i = data.length - 1; i >= 0; i--) {
                data[i].y = y_array[i];
            }
            mean_flag = false;
        } else{
            for (var i = data.length - 1; i >= 0; i--) {
                data[i].y = y_array_mean[i];
            };
            mean_flag = true;
        };
        Plotly.redraw('tester')
    });

    $('.hideshow button').click(function(){
        var btn_id = this.parentNode.id;
            //data_index = 0,
        if (btn_id === 'glob'){
            var data_index = 0;
        } 
        else if (btn_id === 'n_hem'){
            var data_index = 1;  
        }
        else if (btn_id === 's_hem'){
            var data_index = 2;  
        }
        
        // var tester = document.getElementById("tester");
        var temp_data = document.getElementById("tester").data;
        // var trace = temp_data.splice(btn_id,1);
        
        // var visible = trace.visible;
        var visible = document.getElementById("tester")
                .data[data_index].visible;
        var visibilities =unpack(document.getElementById("tester").data,'visible');

        
        if( visible === undefined ) {
            Plotly.restyle("tester", 'visible', "legendonly")
            visible = true;
        }
        else if ( visible === true ){
            if(visibilities.indexOf("legendonly") != -1){
                for (var i = temp_data.length - 1; i >= 0; i--) {
                    document.getElementById("tester")
                    .data[i].visible = true;
                };
                visible = true;    
            }
            else if(visibilities.indexOf("legendonly") === -1){
            for (var i = temp_data.length - 1; i >= 0; i--) {
                document.getElementById("tester")
                .data[i].visible = "legendonly";
            };
                visible = true
            }
            else{
                for (var i = temp_data.length - 1; i >= 0; i--) {
                    document.getElementById("tester")
                    .data[i].visible = "legendonly";
                };
                visible = "true";
            };
            
            //visible = false;
        }
        else if ( visible === "legendonly" ){
            if(visibilities.indexOf("legendonly") === -1){
            for (var i = temp_data.length - 1; i >= 0; i--) {
                document.getElementById("tester")
                .data[i].visible = "legendonly";
            };
                visible = true
            }else{
                for (var i = temp_data.length - 1; i >= 0; i--) {
                    document.getElementById("tester")
                    .data[i].visible = "legendonly";
                };
                visible = true 
            };
        };

        document.getElementById("tester")
                .data[data_index].visible = visible;

        //Plotly.restyle("tester", 'visible', visible, data_index);
        Plotly.restyle("tester", 'visible');
    });
</script>

</body>
</html>